<!doctype html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>{% block title %}{% endblock %}</title>
    <script src="https://cdn.dcsaas.net/js/appstore-sdk.js"></script>

    <script>
        var events = [];
        var app = new ShopApp(function (app) {
            app.init(null, function (params, app) {
                if (localStorage.getItem('styles') === null) {
                    for(var x = 0; x < params.styles.length; ++x) {
                        var el = document.createElement('link');
                        el.rel = 'stylesheet';
                        el.type = 'text/css';
                        el.href = params.styles[x];
                        document.getElementsByTagName('head')[0].appendChild(el);
                    }
                }
                localStorage.setItem('styles', JSON.stringify(params.styles));

                app.show(null ,function () {
                    app.adjustIframeSize();
                    for(var i in events){
                        events[i](app);
                    }
                });


            }, function (errmsg, app) {
                alert(errmsg);
            });
        }, true);


        (function () {
            var styles;
            var sLength;
            var el;

            if (localStorage.getItem('styles') === null) {
                return false;
            }

            styles = JSON.parse(localStorage.getItem('styles'));
            sLength = styles.length;

            for (var x = 0; x < sLength; ++x) {
                el = document.createElement('link');
                el.rel = 'stylesheet';
                el.type = 'text/css';
                el.href = styles[x];
                document.getElementsByTagName('head')[0].appendChild(el);
            }
        }());
    </script>
</head>
<body>

<main class="rwd-layout-width rwd-layout-container">
    <section class="rwd-layout-col-12">

        <div class="edition-form">

            {% block body %}{% endblock %}

            <div class="clearfix"></div>
        </div>
    </section>
</main>

{% block javascripts %}{% endblock %}

<script>
    events.push(function(app){
        {% for flashMessage in app.session.flashbag.get('notice') %}
        app.flashMessage({
            msg : '{{ flashMessage }}',
            type : 'success'
        });
        {% endfor %}
        {% for flashMessage in app.session.flashbag.get('error') %}
        app.flashMessage({
            msg : '{{ flashMessage }}',
            type : 'error'
        });
        {% endfor %}
    })
</script>

</body>
</html>
